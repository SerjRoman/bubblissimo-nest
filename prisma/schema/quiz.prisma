enum QuizStatus {
  PUBLISHED
  DRAFT
}

enum QuizVisibility {
  PRIVATE
  PUBLIC
}

model Quiz {
  id               String           @id @default(auto()) @map("_id") @db.ObjectId
  title            String
  visibility       QuizVisibility   @default(PRIVATE)
  status           QuizStatus       @default(DRAFT)
  coverImage       String?
  tags             Tag[]            @relation(fields: [tagsIds], references: [id], name: "QuizTagRelation")
  tagsIds          String[]         @db.ObjectId
  languages        Language[]       @relation(fields: [languagesIds], references: [id], name: "QuizLanguageRelation")
  languagesIds     String[]         @db.ObjectId
  shuffleAnswers   Boolean          @default(false)
  shuffleQuestions Boolean          @default(false)
  subject          Subject          @relation(fields: [subjectId], references: [id], name: "QuizSubjectRelation")
  subjectId        String           @db.ObjectId
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt
  favouritedBy     User[]           @relation(fields: [favouritedByIds], references: [id], name: "FavouriteQuizzesRelation")
  favouritedByIds  String[]         @db.ObjectId
  createdBy        TeacherProfile   @relation(fields: [createdById], references: [id], name: "CreatedQuizzesRelation")
  createdById      String           @db.ObjectId
  ownedBy          TeacherProfile   @relation(fields: [ownedById], references: [id], name: "OwnedByQuizzesRelation")
  ownedById        String           @db.ObjectId
  copiedBy         TeacherProfile[] @relation(fields: [copiedByIds], references: [id], name: "CopiedQuizzesRelation")
  copiedByIds      String[]         @db.ObjectId
  originalQuiz     Quiz?            @relation(fields: [originalQuizId], references: [id], name: "QuizCopiedRelation", onDelete: NoAction, onUpdate: NoAction)
  originalQuizId   String?          @db.ObjectId
  copies           Quiz[]           @relation(name: "QuizCopiedRelation")
  completedBy      StudentProfile[] @relation(fields: [completedByIds], references: [id], name: "CompletedByRelation")
  completedByIds   String[]         @db.ObjectId
  folders          QuizFolder[]     @relation(fields: [folderIds], references: [id], name: "QuizFolderQuizzesRelation")
  folderIds        String[]         @db.ObjectId
  questions        QuestionToQuiz[]
  sessions         Session[]        @relation(name: "QuizSessionRelation")
  accesses         QuizAccess[]     @relation(name: "QuizAccessQuiz")
}

model QuestionToQuiz {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  quiz       Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  quizId     String   @db.ObjectId
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)
  questionId String   @db.ObjectId

  order Int
  time  Int

  @@unique([quizId, order])
}
